<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	<link rel="stylesheet" type="text/css" href="../css/index.css">
	<link rel="stylesheet" type="text/css" href="../css/prism.css">
	<script type="text/javascript" src="../css/prism.js"></script>
	<title>LsBlog</title>
</head>
<body>
	<div class="left-slider">
		<ul id="slider-list">
			<li class="php">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">PHP</span>
				</div>
			</li>
			<li class="mysql">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">Mysql</span>
				</div>
			</li>
			<li class="js">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">JavaScript</span>
				</div>
			</li>
			<li class="web">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">Web</span>
				</div>
			</li>
			<li class="notebook">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">NoteBook</span>
				</div>
			</li>
			<li class="about">
				<div class="left-message">
					<div class="left-sj"></div>
					<span class="left-message-name">AboutMe</span>
				</div>
			</li>
			<li class="setting">
				<div class="slider-setting">
					<span style="display: inline-block;position: absolute;left:25px;font-size: 14px;font-weight: 400">侧边栏自动隐藏</span><input class="switch switch-anim" type="checkbox" checked style="margin:25px 0 0 40px">
				</div>
			</li>
		</ul>
	</div>

	<div class="article-list"> 
		<div class="detail-article-body">
		
			<div class="article-content">
				

				<h1><center>php加密压缩文件</center></h1>
<h2>前言</h2>
<p>近几日,用爬虫采集的了一些数据,存放到硬盘中,随着数据量越来越多,所以想上传到网盘当中,可是不加下密又觉得不放心,
所以开始用PHP的zip模块进行压缩加密.</p>
<h2>开始</h2>
<pre><code class="language-php">
$zipArc = new \ZipArchive();

if ($zipArc-&gt;open('/home/test.zip', ZipArchive::CREATE | ZipArchive::OVERWRITE) === true) {

    //设置密码 注意此处不是加密,仅仅是设置密码
    if (!$zipArc-&gt;setPassword('password')) {
        throw new RuntimeException('Set password failed');
    }

    //往压缩包内添加文件
    $zipArc-&gt;addFile('/home/test.png', '1/test.png');

    //加密文件 此处文件名及路径是压缩包内的
    if (!$zipArc-&gt;setEncryptionName('1/test.png', ZipArchive::EM_AES_256)) {
        throw new RuntimeException('Set encryption failed');
    }

}

$zipArc-&gt;close();</code></pre>
<h2>注意事项</h2>
<h4>1 PHP7.2以下不支持加密</h4>
<p>php7.2 以下是不支持加密的,我们看一下php官方文档中的解释</p>
<blockquote>
<p>从PHP 7.2.0和libzip 1.2.0开始，密码用于解压缩归档，也是ZipArchive :: setEncryptionName（） 和ZipArchive :: setEncryptionIndex（）的默认密码。</p>
<p>以前，此功能仅设置用于解压缩存档的密码; 它没有将非密码保护的ZipArchive 变成受密码保护的ZipArchive。</p>
</blockquote>
<p>也就是说php7.2之前,setPassword('password')这个方法仅仅是设置setEncryptionName()和setEncryptionIndex()的默认密码,却没有进行加密操作!!!,就问你坑不坑!!</p>
<h4>2 方法找不到</h4>
<p>提示没有setEncryptionName和setEncryptionIndex方法时,请编译时zip模块时用以下参数</p>
<pre><code class="language-bash">--with-libzip
--enable-zip</code></pre>
<h3>3 目录结构问题</h3>
<p>待压缩的文件目录,比说说是/home/test/a.png
压缩后,你发现压缩包内的目录结构是/home/test/a.png,
也就是说压缩包原封不动的保持了原来文件的目录.可是我们想自定义压缩包目录怎么办呢?</p>
<pre><code class="language-php">
$a = '/home/test.png';
$b = '1/test.png';

//$a是待添加的文件路径  $b是压缩包内的路径
$zipArc-&gt;addFile($a, $b);</code></pre>
<h2>参考资料</h2>
<ul>
<li><a href="https://segmentfault.com/q/1010000010558345">php ziparchive压缩文件夹时，Zip文件目录结构不对</a></li>
<li><a href="http://www.php.net/manual/en/class.ziparchive.php">官方文档 ZipArchive class</a></li>
</ul>
			</div>
		</div>
	</div>
</body>
</html>